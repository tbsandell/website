---
layout: euler
title: Euler 02
num: 02
---
{% assign languageSwitcherId = 1 %}

> Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:
> $$1, 2, 3, 5, 8, 13, 21, 34, 55, 89, \dots$$
> By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.


The Fibonacci sequence is given by
$$ f_n = f_{n-1} + f_{n-2} $$
$$ f_0 = 0,\ f_1 = 1 $$
The simplest way to solve the problem is to keep generating fibonacci numbers and adding them if they are even
The program runs in $ O(n) $ where $ n $ is the number of fibonacci numbers less than $ limit $

{% include eulerSolution.html num=1 languages="js,cpp,py" %}

The program can be further optimized by noticing that every third Fibonacci number is even
Therefore, you only need to calculate every third number and don't even need to check if it's even
The conversion is fairly simple

<div>\(
\begin{align*} 
f_{n+3} &= f_{n+2} + f_{n+1} \\
        &= (f_{n+1} + f_n) + (f_n + f_{n-1}) \\
        &= (f_n + f_{n-1} + f_n) + (f_n + f_{n-2} + f_{n-3}) \\
        &= 3f_n + f_{n-1} + f_{n-2} + f_{n-3} \\
        &= 3f_n + f_n + f_{n-3} \\
        &= 4f_n + f_{n-3}
\end{align*}
\)</div>

Adjusting the program for this speeds it up a bit
Of course, since it was so fast in the first place, the difference isn't noticable
The program still runs in $ O(n) $ but is just a bit faster

{% include eulerSolution.html num=2 languages="js,cpp,py" %}

As with problem 1, there is also a purely mathematical solution to this problem.
Define the sequence $ g_n $ to be the nth even fibonacci number
$$ g_n = 4g_{n-1} + g_{n-2} $$
$$ g_{-1} = 0,\ g_0 = 2,\ g_1 = 8 $$

<div>\(
\begin{aligned}
G(x) &= \sum_{n=0}^\infty g_nx^n \\
    &= 2 + \sum_{n=1}^\infty g_nx^n \\
    &= 2 + \sum_{n=1}^\infty (4g_{n-1} + g_{n-2})x^n \\
    &= 2 + \sum_{n=1}^\infty 4g_{n-1}x^n + g_{n-2}x^n \\
    &= 2 + \sum_{n=1}^\infty 4g_{n-1}x^n + \sum_{n=1}^\infty g_{n-2}x^n \\
    &= 2 + 4x\sum_{n=1}^\infty g_{n-1}x^{n-1} + x^2\sum_{n=1}^\infty g_{n-2}x^{n-2} \\
    &= 2 + 4x\sum_{n=0}^\infty g_nx^n + x^2\sum_{n=-1}^\infty g_nx^n \\
    &= 2 + 4x\sum_{n=0}^\infty g_nx^n + 0 + x^2\sum_{n=0}^\infty g_nx^n \\
    &= 2 + (x^2 + 4x)\sum_{n=0}^\infty g_nx^n \\
G(x) &= 2 + (x^2 + 4x) \times G(x) \\
  -2 &= (x^2 + 4x - 1) \times G(x) \\
G(x) &= {-2 \over x^2 + 4x - 1} \\
G(x) &= {-2 \over (2 -\sqrt 5 + x) (2 + \sqrt 5 + x)} \\
G(x) &= {1 \over \sqrt 5 (x + \sqrt 5 + 2)} + {1 \over \sqrt 5 (-x + \sqrt 5 - 2)} \\
G(x) &= {1 \over \sqrt 5} \left({1 \over x + \sqrt 5 + 2} + {1 \over -x + \sqrt 5 - 2}\right) \\
G(x) &= \sum_{n=0}^\infty {(2 + \sqrt 5)^{1 + n} - (2 - \sqrt 5)^{1 + n} \over \sqrt 5}x^n
\end{aligned}
\)</div>

$$ g_n = {(2 + \sqrt 5)^{1 + n} - (2 - \sqrt 5)^{1 + n} \over \sqrt 5} $$
Since this formula is for the $ (n + 1)\text{th} $ even Fibonacci number, we can derive a new formula for the $ n\text{th} $ even Fibonacci number
$$ g_n = {(2 + \sqrt 5)^{n} - (2 - \sqrt 5)^{n} \over \sqrt 5} $$
Then define $ G(n) $ to be the sum of the first $ n $ even Fibonacci numbers (Including 0)

<div>\( 
\begin{aligned}
G(n) &= \sum_{i=0}^n g_n \\
    &= \sum_{i=0}^n {(2 + \sqrt 5)^n - (2 - \sqrt 5)^n \over \sqrt 5} \\
    &= {1 \over \sqrt 5} \sum_{i=0}^n \left((2 + \sqrt 5)^n - (2 - \sqrt 5)^n\right) \\
    &= {1 \over \sqrt 5} \left( \sum_{i=0}^n (2 + \sqrt 5)^n - \sum_{i=0}^n (2 - \sqrt 5)^n \right) \\
    &= {1 \over \sqrt 5} \left({1 - (2 + \sqrt 5)^n \over 1 - 2 - \sqrt 5} - {1 - (2 - \sqrt 5)^n \over 1 - 2 + \sqrt 5} \right) \\
    &= {(1 + \sqrt 5)(2 - \sqrt 5)^n - (1 - \sqrt 5)(2 + \sqrt 5)^n - 2\sqrt 5 \over 4\sqrt5}
\end{aligned}
\)</div>

Assume there are 12 even Fibonacci numbers less than $4000000$.
Then,
$$ G(12) = {(1 + \sqrt 5)(2 - \sqrt 5)^{12} - (1 - \sqrt 5)(2 + \sqrt 5)^{12} - 2\sqrt 5 \over 4\sqrt5} = 4613732 $$
